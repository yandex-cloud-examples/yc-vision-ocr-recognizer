# Cloud Function для OCR обработки изображений и документов

<img src="../../img/diag-2.jpg" width="600px" alt="Процесс распознавания длинных аудио файлов" />
<br><br>

Данный модуль создает следующие ресурсы:

1. Бакет Object Storage
2. Функцию Cloud Function
3. Cron тригер для функции, который срабатывает при появлении новых файлов в бакете 
4. Сервисную учетную запись с правами для работы с Object Storage, SpeechKit, Lockbox
5. Сервисную учетную запись для запуска функции Cloud Function
6. Статический ключ доступа для работы с Object Storage и API-ключ для работы со Speechkit
7. Секрет в [Lockbox](https://cloud.yandex.ru/services/lockbox) для безопасного хранения ключей, используемых функцией Cloud Function (сервис Lockbox находится в Preview)

По умолчанию, используются следующие переменные для имен директорий внутри бакета:
* `s3_prefix_input = "input"`
* `s3_prefix_out = "result"`

Также, используется аутентификация в провайдере Terraform через `key.json` файл. 
При необходимости, измените аутентификацию на токен.

## Установка

Чтобы запустить данный модуль, создайте файл с переменными `private.auto.tfvars` и сохраните в него folder_id и cloud_id вашего облака и каталога в нем:
```
cloud_id  = "b1g3xxxxxx"
folder_id = "b1g7xxxxxx
```

После этого, можно установить модуль Terraform:
```
terraform init
terraform apply
```

## Использование

После создания модуля, необходимо загрузить поддерживаемые изображения и документы в созданный бакет, в директорию `input`.

Функция будет запущена по тригеру, при появлении нового файла в папке `input`, и отправит файл на распознавание, после чего – получит результат и сохранит его в папку `result`.
Статус работы функции можно отслеживать в ее логах, а также по созданию и содержимому файлов в папке `result`.

## Удаление

Перед удалением, не забудьте очистить созданный бакет (иначе процесс удаления прервется):
```
terraform destroy
```